\documentclass[discrete.tex]{subfiles}

\begin{document}
  \section{Два алгоритма перебора перестановок. Нумерация перестановок}

  \[|P_k| = k! = |T_k|\]
  $P_k$ - мн-во всех перестановок\\
  \[T_k = \prod_{i=1}^k M_i =\{0\} \times \{0,1\} \times ... \times \{0,1,...,k-1\}\]

  Построим взаимно однозначное соответствие между $P_k$ и $T_k$. Возьмем перестановку ($t_1,...,t_k$) и сопоставим ей перестановку ($r_1,...,r_k$) следующим образом: для любого $i \in 1:k$ найдем число значений, меньше $r_i$ среди $r_{i+1},...,r_k$ - это число мы и примем в качестве $t_i$\\

  В соответсвии с таким определеничем чисел $t_i$ в мн-ве $T_k$ будет естественно сделать значения $m_i$ не возрастающими, а убывающая до единицы

  Разберем $r = (4,\ 8,\ 1,\ 5,\ 7,\ 2,\ 3,\ 6)$
  \[\begin{matrix}
    i & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8\\
    r_i & 4 & 8 & 1 & 5 & 7 & 2 & 3 & 6\\
    t_i & 3 & 6 & 0 & 2 & 3 & 0 & 0 & 0\\
    m_i & 8 & 7 & 6 & 5 & 4 & 3 & 2 & 1
  \end{matrix}\]
  \[t_1 = |\{1,2,3\}| \q t_2 = |\{1,5,7,2,3,6\}|, \q t_3 = |\{\}|,\q ...\]

  По ($t_1,...,t_k$) легко восстановить исходную перестановку. Для этого меняя i от 1 до k нужно проверить мн-во значений $S_i$, которые могут быть в перестановке на i месте.

  В нашем примере для $i=1$ $S_1 = 1:8$, $t_1 = 3 \Ra r_1 = 4$, далее $S_2 = 1:3 \cap 5:8$, $t_2 = 6 \Ra r_2 = 8$.

  \begin{remark}
    Если использовать это отображение при переборе, то перестановки будут перебираться в лексикографическом порядке
  \end{remark}
  
  \begin{definition}
    ($r_1,...,r_k$) предшествует ($R_1,...,R_k$), если начала перестановок совпадают до индекса i, а дальше $r_i < R_i$\\
  \end{definition}

  \begin{alg}[1]
    Если перестановки перебираются в лексикографическом порядке, можно вывести правило получения следующего:
    \begin{enumerate}
      \item В перестановке ($r_1,...,r_k$) найти наибольший суффикс ($r_t,...,r_k$), в котором элементы расположены по убыванию $r_t > ... > r_k$; ($r_{t-1} < r_t$ - суффикс максимальн)
      \item Выбрать ($r_t,...,r_k$) элемент следующий по величине после $r_{t-1}$ и поставить его на место $t-1$. Оставшиеся элементы, включая $r_{t-1}$ расположить в порядке возрастания
      \[\begin{tabular}{c|cccc|cccc}
        \num & \multicolumn{4}{c}{t_k} & \multicolumn{4}{c}{p_k}\\
        \hline
        0 &  0 & 0 & 0 & 0 &  1 & 2 & 3 & \ul{4}\\
        1 &  0 & 0 & 1 & 0 &  1 & 2 & \ul{4} & \ul{3}\\
        2 &  0 & 1 & 0 & 0 &  1 & 3 & 2 & \ul{4}\\
        3 &  0 & 1 & 1 & 0 &  1 & 3 & \ul{4} & \ul{2}\\
        4 &  0 & 2 & 0 & 0 &  1 & 4 & 2 & \ul{3}\\
        5 &  0 & 2 & 1 & 0 &  1 & \ul{4} & \ul{3} & \ul{2}
      \end{tabular}\]
    \end{enumerate}
  \end{alg}

  \begin{remark}
    Чтобы найти номер перестановки используем факториальную запись:
    \[\begin{matrix}
      p & & 3 & 4 & 2 & 1\\
      t & & \us{3}{2} & \us{2}{2} & \us{1}{1} & \us{0}{0}
    \end{matrix}\]
    \[\num = 2 \cdot 3! + 2 \cdot 2! + 1 \cdot 1! + 0 \cdot 0! = 7\]
    Так можем, например, найти перестановку через n шагов от данной: сначала ищем номер исходной, прибавляем n, затем выполняя поэтапное деление в столбик на значение факториалов, восстанавливаем перестановку
  \end{remark}

  \begin{Alg}[2]
    \[r = (1,2,...,k) \text{ - рабочая перестановка}\]
    \[t = (0,0,...,0) \text{ - номер r в факториальной системе счисления}\]
    \[\text{(младший разряд последний)}\]
    \[d = (-1,-1,...,-1) \text{ - направление движения элементов}\]
    \[p = (1,2,...,k) \text{ - сопоставление каждому i места, в котором он в r}\]
    \begin{enumerate}
      \item Увеличить t на 1. При этом несколько младших разрядов получат нулевые значения, в j-м значении ув-ся на 1. При $j=1$ процесс заканчивается
      \item Сменить направление движения всех элементов младше j-го ($d_i = - d_i$ для $i>j$). Поменять местами j и соседний с ним (если $d_j--1$ - левый, $d_j$ - правый)
      \[\begin{tabular}{c|cccc|cccc|cccc|cccc|c|c}
        i & t & d & p & r & j & \text{Комментарий}\\
        \hline
        1   &   0000   &   -\ -\ -\ -   &   1234   & 1234   &   -\\
        2   &   0001   &   -\ -\ -\ -   &   1243   & 1243   &   4   &   \text{Нач-ся движение эл-та 4}\\
        \\
        4   &   0003   &   -\ -\ -\ -   &   2341   & 4123   &   4\\
        5   &   0010   &   -\ -\ -\ +   &   2431   & 4132   &   3   &   \text{Шаг эл-та 3, у 4 смена направления}\\
        6   &   0011   &   -\ -\ -\ +   &   1432   & 1432   &   4\\
        7   &   0012   &   -\ -\ -\ +   &   1423   & 1342   &   4\\
        8   &   0013   &   -\ -\ -\ +   &   1324   & 1324   &   4\\
        9   &   0020   &   -\ -\ -\ -   &   2314   & 3124   &   3 & \text{Второй шаг эл-та 3}\\
      \end{tabular}\]
    \end{enumerate}
  \end{Alg}
\end{document}
